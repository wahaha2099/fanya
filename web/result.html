<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=Edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="keywords" content="泛亚">
    <meta name="description" content="泛亚">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/static/plugins/swiper/css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/vote.css">
    <title>签到</title>
</head>

<body id="body">

    <div class="head">
        <img src="/static/imgs/head.jpg" width="100%">
        <div class="title"><img  src="/static/imgs/gezi.jpg"/><b>普通投票</b><img src="/static/imgs/gezi.jpg" /></div>
    </div>

    <div class="content">

            <div class="election-div">
                <div class="items">
                    <template v-for="item in items">
                        <div class="election" v-bind:class="{ 'right' : $index % 2 != 0  }">
                            <img src="{{ item.url }}" @click="showItem( item )">
                            <div>{{ item.text }} <span class="rs"><img class='icon'src="/static/imgs/good.png"> {{ item.count }} 票</span></div>
                        </div>
                    </template>

                </div>
            </div>

        <div class="alert" v-show="showDetail" style="display: none">
            <div class="bg"></div>

            <div class="center">
                <span class="close" @click="closeItem"></span>
                <div class="img" ><img src="{{ detail.refer_user.head_image }}"/>
                </div>

                <div class="info">
                    <b>{{ detail.refer_user.name }}</b>
                    <hr>
                    {{ detail.refer_user.detail }}

                </div>
            </div>
        </div>


        <div class="submit">
            <div class="button" @click="submit" ><img src="/static/imgs/back.png" width="20px">返 回</div>
        </div>
    </div>

    <script type="text/javascript" src="/static/js/vue.min.js"></script>
    <script>

        var vue = new Vue({
            el: '#body',
            data: {
                parentMessage: 'Parent',
                type:'vote1',
                items: [],
                checked:[],//已选列表
                detail:null,
                showDetail:false,
                selectCount:1
            },
            ready:function () {
                this.loadData();
            },
            methods:{
                showItem:function( item ){//显示候选人详情
                    if( item.refer_type != 1)return ;
                    this.bodyClass = 'html-body-overflow';
                    this.detail = item ;
                    this.showDetail = true ;
                },
                closeItem:function(){//关闭候选人详情
                    this.bodyClass = 'html-body-auto';
                    this.showDetail = false ;
                },
                /*页面操作函数 结束*/
                loadDataError:function( response){
                    console.log(response);
                    alert('请求失败，请重试');
                },
                loadData:function(){//读取页面数据
                    this.type = getUrlParam('type') == '1' ? 'election' : 'vote';

                    var callback = function(rsp){
                        if( rsp.data.code ==0 ){
                            this.selectCount = rsp.data.per_num;
                            for(var i = 0 ; i < rsp.data.data.length ; i++){
                                var item = rsp.data.data[i];
                                item.url = "/static/imgs/toupiao-bg.jpg" ;
                                if(item.refer_type == 1)
                                    item.refer_user.head_image = "/static/imgs/toupiao-bg.jpg" ;
                                vue.items.push( item );
                            }
                        }
                    }
                    var url = '/v1/mobile/vote/'+ getUrlParam('id')+'/last/result';
                    Site.get( url  , callback , this.loadDataError );
                },
                submit:function () {
                   Site.goto('sign.html');
                }
            }
        });

    </script>
</body>
</html>